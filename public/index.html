<!doctype html>
<html>
  <head>
    <title>{%=o.title%}</title>
    <style>
    html, body {
      padding: 0;
      margin: 0;
    }
    .container header {
      border-bottom: 1px solid #DDD;
      background-color: #333;
      color: #FFF;
    }
    .container header h1 {
      font-size: 1rem;
      font-weight: normal;
      line-height: 1;
      margin: 0;
    }
    .container>header, .container>article {
      padding: .5rem 1rem;
    }
    .container>article ol {
      line-height: 1.8;
      font-size: 1rem;
    }
    .container>article ol li {
      color: #666;
    }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>tail {%=o.realfile%}</h1>
      </header>
      <article>
        <ol id="content"></ol>
      </article>
    </div>
    <script>
    const fd = {%=o.fd%}
    const extname = '{%=o.extname%}'
    const url = `ws://${location.host}${location.pathname}?fd=${fd}`
    const socket = new WebSocket(url)
    const content = document.getElementById('content')

    const append = (data) => {
      switch (extname) {
        case '.log':
        case '.txt':
        default:
          const lines = data.split("\n")

          if (content.lastChild) {
            const first = lines.shift()
            content.lastChild.textContent += first

            content.lastChild.style.display = null
          }
          const fragment = document.createDocumentFragment()
          lines.forEach(line => {
            const li = document.createElement('li')
            li.textContent = line

            if (!line) {
              li.style.display = 'none'
            }
            fragment.appendChild(li)
          })

          content.appendChild(fragment)
          break
      }
    }

    append({%#JSON.stringify(o.content)%})
    socket.onmessage = (message) => {
      append(message.data)
    }
    </script>
  </body>
</html>
